(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{268:function(e,t,n){},269:function(e,t,n){},274:function(e,t,n){"use strict";var a=n(33),r=n.n(a),o=n(3),l=n.n(o),c=n(0),i=n.n(c),s=n(55),u=n(18),d=n(8),m=n(22),b=n(77),f=n(63),p=n(210),g=n.n(p),v=n(325),h=(n(268),function(e){var t=e.columns,n=e.onDragDrop,a=e.onRemove;return i.a.createElement(v.a,{onDragEnd:function(e){e.destination&&n(e.source.index,e.destination.index)}},i.a.createElement(v.c,{droppableId:"droppable",direction:"horizontal"},(function(e){return i.a.createElement("div",g()({ref:e.innerRef,className:Object(b.b)({b:"column-select-drag-drop",e:"list"})},e.droppableProps),t.map((function(e,t){var n=e.itemId,r=e.label;return i.a.createElement(v.b,{key:n,draggableId:n,index:t},(function(e,t){return i.a.createElement("div",g()({ref:e.innerRef},e.draggableProps,e.dragHandleProps,{className:"button ".concat(Object(b.b)({b:"column-select-drag-drop",e:["list","item"],m:t.isDragging&&"dragging"})),style:e.draggableProps.style}),r,i.a.createElement("button",{type:"button","data-testid":"column-select-dnd-remove-button",className:Object(b.b)({b:"column-select-drag-drop",e:["list","item","button"]}),onClick:function(){return a(n)}},i.a.createElement(m.CloseIcon,{className:Object(b.b)({b:"column-select-drag-drop",e:["list","item","button","icon"]})})))}))})),e.placeholder)})))}),E=n(10),y=(n(269),function(e,t){return i.a.createElement("div",{className:Object(b.b)({b:"column-select",e:"tab-title"})},e,i.a.createElement("span",{className:Object(b.b)({b:"column-select",e:["tab-title","count"],m:t.length?"visible":"hidden"})},i.a.createElement(m.Bubble,{size:"small",value:t.length})))}),O=function(e){var t=e.selectedColumns,n=e.fieldData,a=e.onDragDrop,r=e.onSelect,o=e.onReset,l=function(e,t){var n=new Array(e.length);return[E.a.data,E.a.links].forEach((function(a){t[a].forEach((function(t){var r=t.id;t.items.forEach((function(t){var o=t.id,l=t.label,c=e.indexOf(o);c>=0&&(n[c]={tabId:a,accordionId:r,itemId:o,label:l})}))}))})),n}(t,n),c=[E.a.data,E.a.links].map((function(e){var t=l.filter((function(t){return t.tabId===e}));return{title:y(e,t),id:e,key:e,content:i.a.createElement(m.AccordionSearch,{accordionData:Object.values(n[e]),onSelect:function(e,t){return r(t)},selected:t,columns:!0})}}));return i.a.createElement("div",{className:"column-select"},i.a.createElement(h,{columns:l,onDragDrop:a,onRemove:r}),i.a.createElement("button",{className:"button secondary",type:"button",tabIndex:0,onClick:o,"data-testid":"column-select-reset-button"},"Reset to default"),i.a.createElement(m.Tabs,{tabData:c}))},C=n(57),w=n(35);function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){l()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var k={tabId:E.a.data,accordionId:"Names & Taxonomy",itemId:w.a.accession},F=Object(d.o)(Object(s.b)((function(e,t){return{onChange:t.onChange,fieldData:e.results.fields.data,isFetching:e.results.fields.isFetching}}),(function(e){return Object(u.b)({fetchFieldsIfNeeded:function(){return f.d()}},e)}))((function(e){var t=e.fetchFieldsIfNeeded,n=e.isFetching,a=e.fieldData,o=e.selectedColumns,c=e.onChange;if(n||!a||!a[E.a.data]||!a[E.a.data].length||!a[E.a.links]||!a[E.a.links].length)return t(),i.a.createElement(m.Loader,null);var s=o.filter((function(e){return e!==k.itemId})),u=function(e,t){var n=e.tabId,a=e.accordionId,r=e.itemId;return D(D({},t),{},l()({},n,t[n].map((function(e){return e.id===a?D(D({},e),{},{items:e.items.filter((function(e){return e.id!==r}))}):e}))))}(k,a),d=function(e){c([k.itemId].concat(r()(e)))};return i.a.createElement(O,{selectedColumns:s,fieldData:u,onReset:function(){return c(C.c)},onSelect:function(e){var t=s.indexOf(e);d(t>=0?Object(b.e)(s,t):[].concat(r()(s),[e]))},onDragDrop:function(e,t){d(Object(b.d)(s,e,t))}})})));t.a=F},413:function(e,t,n){},429:function(e,t,n){"use strict";n.r(t),n.d(t,"getPreviewFileFormat",(function(){return w}));var a=n(38),r=n.n(a),o=n(0),l=n.n(o),c=n(55),i=n(8),s=n(197),u=n.n(s),d=n(22),m=n(274),b=n(10),f=(n(413),function(e){var t,n=e.onSubmit,a=e.onCancel,r=e.onPreview,c=e.selectedColumns,i=e.downloadAll,s=e.fileFormat,u=e.compressed,f=e.preview,p=e.loadingPreview,g=e.onSelectedColumnsChange,v=e.onDownloadAllChange,h=e.onFileFormatChange,E=e.onCompressedChange,y=e.nSelectedEntries,O=e.nPreview,C=e.totalNumberResults;return p?t=l.a.createElement(d.Loader,null):f&&f.length&&(t=l.a.createElement("div",{className:"preview"},l.a.createElement("h4",null,"Preview"),l.a.createElement("div",{className:"preview__container"},l.a.createElement("pre",{className:"preview__inner","data-testid":"download-preview"},f)))),l.a.createElement(o.Fragment,null,l.a.createElement("form",{onSubmit:n,className:"download","data-testid":"download-form"},l.a.createElement("h3",null,"Download"),l.a.createElement("label",{htmlFor:"data-selection-false"},l.a.createElement("input",{id:"data-selection-false",type:"radio",name:"data-selection",value:"false",checked:!i,onChange:v,disabled:0===y}),"Download selected (",y,")"),l.a.createElement("label",{htmlFor:"data-selection-true"},l.a.createElement("input",{id:"data-selection-true",type:"radio",name:"data-selection",value:"true",checked:i,onChange:v}),"Download all (",C,")"),l.a.createElement("fieldset",null,l.a.createElement("legend",null,"Format"),l.a.createElement("select",{id:"file-format-select","data-testid":"file-format-select",value:s,onChange:h},Object.values(b.b).filter((function(e){return e!==b.b.rdfXml})).map((function(e){return l.a.createElement("option",{value:e,key:e},e)})))),l.a.createElement("fieldset",null,l.a.createElement("legend",null,"Compressed"),l.a.createElement("label",{htmlFor:"compressed-true"},l.a.createElement("input",{id:"compressed-true",type:"radio",name:"compressed",value:"true",checked:u,onChange:E}),"Yes"),l.a.createElement("label",{htmlFor:"compressed-false"},l.a.createElement("input",{id:"compressed-false",type:"radio",name:"compressed",value:"false",checked:!u,onChange:E}),"No")),b.g.includes(s)&&l.a.createElement("fieldset",null,l.a.createElement("legend",null,"Customize data"),l.a.createElement(m.a,{onChange:g,selectedColumns:c})),l.a.createElement("div",{className:"button-group customise-table--cancel-submit-buttons"},l.a.createElement("button",{className:"button secondary",type:"button",onClick:a},"Cancel"),l.a.createElement("button",{className:"button secondary",type:"button",onClick:function(){return r(O)}},"Preview ",O),l.a.createElement("button",{className:"button",type:"submit"},"Download"))),t)}),p=n(47),g=n(33),v=n.n(g),h=n(28),E=n.n(h),y=n(422),O=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=E.a.parseUrl(e),r=E.a.parseUrl(t);if(a.url!==r.url)return!1;var o=Object(y.a)([].concat(v()(Object.keys(a.query)),v()(Object.keys(a.query))));return o.every((function(e){return n.includes(e)||a.query[e]===r.query[e]}))},C=n(49),w=function(e){return e===b.b.excel?b.b.tsv:e},j=Object(i.o)(Object(c.b)((function(e){return{tableColumns:e.results.tableColumns}}))((function(e){var t=e.tableColumns,n=e.history,a=e.location.state,c=a.query,i=a.selectedFacets,s=a.sortColumn,d=a.sortDirection,m=a.selectedEntries,g=a.totalNumberResults,v=Object(o.useState)(t),h=r()(v,2),E=h[0],y=h[1],j=Object(o.useState)(!0),D=r()(j,2),k=D[0],F=D[1],N=Object(o.useState)(b.b.fastaCanonical),P=r()(N,2),S=P[0],I=P[1],A=Object(o.useState)(!0),R=r()(A,2),x=R[0],q=R[1],T=Object(o.useState)(!1),_=r()(T,2),z=_[0],B=_[1],J=Object(o.useState)({url:"",contentType:"",data:""}),L=r()(J,2),U=L[0],H=L[1],M=m.length,X=Math.min(10,k?g:M),Y=w(S),G=Object(p.c)({query:c,columns:E,selectedFacets:i,sortColumn:s,sortDirection:d,fileFormat:Y,compressed:x,size:X,selectedAccessions:k?[]:m}),K=O(U.url,G,["compressed"])&&U.data&&U.contentType===b.e.get(Y);return l.a.createElement(f,{onSubmit:function(e){e.preventDefault();var t=Object(p.c)({query:c,columns:E,selectedFacets:i,sortColumn:s,sortDirection:d,fileFormat:S,compressed:x,selectedAccessions:k?[]:m}),a=document.createElement("a");a.href=t,a.target="_blank",a.setAttribute("download",""),document.body.appendChild(a),a.click(),document.body.removeChild(a),n.goBack()},onCancel:function(){n.goBack()},onPreview:function(){B(!0),Object(C.a)(G,{Accept:b.e.get(Y)}).then((function(e){var t=u()(e,(function(e){return e.headers["content-type"]}));H({data:t===b.e.get(b.b.json)?JSON.stringify(e.data,null,2):e.data,url:u()(e,(function(e){return e.config.url}))||"",contentType:t})})).catch((function(e){console.error(e)})).finally((function(){B(!1)}))},selectedColumns:E,downloadAll:k,fileFormat:S,compressed:x,onSelectedColumnsChange:y,nSelectedEntries:M,onDownloadAllChange:function(e){return F("true"===e.target.value)},onFileFormatChange:function(e){return I(e.target.value)},onCompressedChange:function(e){return q("true"===e.target.value)},preview:K?U.data:"",loadingPreview:z,nPreview:X,totalNumberResults:g})})));t.default=j}}]);
//# sourceMappingURL=download.1a2a6d.js.map